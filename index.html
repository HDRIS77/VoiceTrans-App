<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>VoiceTrans with OpenAI Translation</title>
</head>
<body>

  <h1>🎙️ Voice to Text & Translation</h1>

  <button onclick="startRecording()">🎤 ابدأ التسجيل</button>
  <button onclick="stopRecording()">🛑 إيقاف التسجيل</button>

  <h3>الكلام الأصلي</h3>
  <div id="original-text"></div>
  <button onclick="copyText('original-text')">📋 نسخ الكلام</button>

  <h3>الترجمة (<span id="lang-label">en</span>)</h3>
  <div id="translated-text"></div>
  <button onclick="copyText('translated-text')">📋 نسخ الترجمة</button>

  <h4>اختر اللغة:</h4>
  <button onclick="setLanguage('en')">إنجليزية</button>
  <button onclick="setLanguage('ur')">أردو (Roman)</button>

  <button onclick="saveToHistory(
    document.getElementById('original-text').innerText,
    document.getElementById('translated-text').innerText)">💾 حفظ</button>

  <h3>📅 سجل اليوم:</h3>
  <ul id="history-list"></ul>
  <button onclick="showTodayHistory()">عرض السجل</button>

  <script>
    const recognition = new window.webkitSpeechRecognition();
    recognition.lang = "ar-EG";
    recognition.continuous = true;

    let selectedLang = "en";
    let originalText = "";

    recognition.onresult = function (event) {
      const transcript = event.results[event.results.length - 1][0].transcript;
      originalText += transcript + " ";
      document.getElementById("original-text").innerText = originalText;
      translateWithOpenAI(originalText, selectedLang);
    };

    function startRecording() {
      originalText = "";
      document.getElementById("original-text").innerText = "";
      document.getElementById("translated-text").innerText = "";
      recognition.start();
    }

    function stopRecording() {
      recognition.stop();
    }

    async function translateWithOpenAI(text, lang) {
      const openAiApiKey = "YOUR_OPENAI_API_KEY"; // <-- استبدلها بمفتاحك الفعلي
      const targetLang = lang === "ur" ? "roman urdu" : "english";
      const prompt = `Translate the following Arabic text to ${targetLang}:\n"""${text}"""`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${openAiApiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{ role: "user", content: prompt }]
        })
      });

      const data = await response.json();
      const translatedText = data.choices?.[0]?.message?.content?.trim();
      document.getElementById("translated-text").innerText = translatedText || "[تعذر الترجمة]";
    }

    function copyText(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(() => alert("تم النسخ"));
    }

    function setLanguage(lang) {
      selectedLang = lang;
      document.getElementById("lang-label").innerText = lang;
    }

    function saveToHistory(original, translated) {
      const today = new Date().toISOString().split("T")[0];
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      if (!history[today]) history[today] = [];
      history[today].push({ original, translated });
      localStorage.setItem("history", JSON.stringify(history));
    }

    function showTodayHistory() {
      const today = new Date().toISOString().split("T")[0];
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      const records = history[today] || [];
      const list = document.getElementById("history-list");
      list.innerHTML = records.map(r => `<li>${r.original} → ${r.translated}</li>`).join("");
    }
  </script>
</body>
</html>
