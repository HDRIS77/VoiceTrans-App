<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>VoiceTrans with OpenAI Translation</title>
</head>
<body>

  <h1>ğŸ™ï¸ Voice to Text & Translation</h1>

  <button onclick="startRecording()">ğŸ¤ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
  <button onclick="stopRecording()">ğŸ›‘ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>

  <h3>Ø§Ù„ÙƒÙ„Ø§Ù… Ø§Ù„Ø£ØµÙ„ÙŠ</h3>
  <div id="original-text"></div>
  <button onclick="copyText('original-text')">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ø§Ù…</button>

  <h3>Ø§Ù„ØªØ±Ø¬Ù…Ø© (<span id="lang-label">en</span>)</h3>
  <div id="translated-text"></div>
  <button onclick="copyText('translated-text')">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªØ±Ø¬Ù…Ø©</button>

  <h4>Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©:</h4>
  <button onclick="setLanguage('en')">Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</button>
  <button onclick="setLanguage('ur')">Ø£Ø±Ø¯Ùˆ (Roman)</button>

  <button onclick="saveToHistory(
    document.getElementById('original-text').innerText,
    document.getElementById('translated-text').innerText)">ğŸ’¾ Ø­ÙØ¸</button>

  <h3>ğŸ“… Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…:</h3>
  <ul id="history-list"></ul>
  <button onclick="showTodayHistory()">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>

  <script>
    const recognition = new window.webkitSpeechRecognition();
    recognition.lang = "ar-EG";
    recognition.continuous = true;

    let selectedLang = "en";
    let originalText = "";

    recognition.onresult = function (event) {
      const transcript = event.results[event.results.length - 1][0].transcript;
      originalText += transcript + " ";
      document.getElementById("original-text").innerText = originalText;
      translateWithOpenAI(originalText, selectedLang);
    };

    function startRecording() {
      originalText = "";
      document.getElementById("original-text").innerText = "";
      document.getElementById("translated-text").innerText = "";
      recognition.start();
    }

    function stopRecording() {
      recognition.stop();
    }

    async function translateWithOpenAI(text, lang) {
      const openAiApiKey = "YOUR_OPENAI_API_KEY"; // <-- Ø§Ø³ØªØ¨Ø¯Ù„Ù‡Ø§ Ø¨Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ
      const targetLang = lang === "ur" ? "roman urdu" : "english";
      const prompt = `Translate the following Arabic text to ${targetLang}:\n"""${text}"""`;

      const response = await fetch("https://api.openai.com/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${openAiApiKey}`
        },
        body: JSON.stringify({
          model: "gpt-3.5-turbo",
          messages: [{ role: "user", content: prompt }]
        })
      });

      const data = await response.json();
      const translatedText = data.choices?.[0]?.message?.content?.trim();
      document.getElementById("translated-text").innerText = translatedText || "[ØªØ¹Ø°Ø± Ø§Ù„ØªØ±Ø¬Ù…Ø©]";
    }

    function copyText(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(() => alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®"));
    }

    function setLanguage(lang) {
      selectedLang = lang;
      document.getElementById("lang-label").innerText = lang;
    }

    function saveToHistory(original, translated) {
      const today = new Date().toISOString().split("T")[0];
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      if (!history[today]) history[today] = [];
      history[today].push({ original, translated });
      localStorage.setItem("history", JSON.stringify(history));
    }

    function showTodayHistory() {
      const today = new Date().toISOString().split("T")[0];
      let history = JSON.parse(localStorage.getItem("history") || "{}");
      const records = history[today] || [];
      const list = document.getElementById("history-list");
      list.innerHTML = records.map(r => `<li>${r.original} â†’ ${r.translated}</li>`).join("");
    }
  </script>
</body>
</html>
